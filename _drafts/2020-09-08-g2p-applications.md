---
layout: post
title:  "Applications for g2p, examples with ReadAlongs and Convertextract"
author: AidanPine
categories: []
tags: [ tutorial, explanation, tech-showcase ]
image: assets/images/bonjour-g2p.png
description: "Applications for g2p, examples with ReadAlongs and Convertextract"
featured: false
hidden: false
---

## Applications

There are number of different software tools that are already making use of `g2p`. For general purpose use in Python, have a look at [this section](#advanced-use-in-python). G2P is also used extensively in the [ReadAlongs](#readalongs) project for creating interactive audio/text documents and in [Convertextract](#convertextract), a tool for doing `g2p` transformations in Microsoft Office documents while preserving the original document formatting.

### ReadAlongs

ReadAlongs is an exploratory research project from the [National Research Council's Indigenous Language Technology Project](https://nrc.canada.ca/en/research-development/research-collaboration/programs/canadian-indigenous-languages-technology-project).

Language revitalization communities have potentially many different recordings of language and some associated text, but mobilizing these materials into something that is educationally useful can be time consuming. It's also tough from the learner's perspective to try and follow along the text (maybe a Word Document) just by simply playing the audio. It's easy to get lost in the recording quickly, and from personal experience, trying to do that usually involves a lot of frustrating rewinding.

What if we could develop a tool that *automatically* figured out what parts of the audio file corresponded to what parts of the text? In [Natural Language Processing](https://en.wikipedia.org/wiki/Natural_language_processing), this is called *forced alignment*, and this is fundamentally what the ReadAlongs project does. But how does it do it? In part, by using a whole bunch of `g2p` mappings!

First of all, it's good to know that forced alignment is essentially a "solved problem" for languages with a lot of data, thanks to people like David Huggins-Daines who is a collaborator on the ReadAlongs project. And, if you know Python, and have 20+ hours of manually aligned text and audio in your language, you can train a model using one of the few tools out there developed for this task, like [the Montreal Forced Aligner](https://montreal-forced-aligner.readthedocs.io/en/latest/). But what if you don't have that much data (or any) and what if you don't know Python? If your language has a `g2p` mapping between its writing system and the ipa, you can likely circumvent that whole process. Here's how:

We take a model for doing forced alignment on English and we manually write a `g2p` mapping from the writing system to IPA for the language we want to make a ReadAlong for. For example's sake let's say, Kanyen'kéha (Mohawk). This step requires somebody who is both familiar with the writing system used, and with the International Phonetic Alphabet. 

Then, we use the very cool Python library [PanPhon](https://github.com/dmort27/panphon) to figure out the mapping between the IPA characters in Mohawk and their *closest* IPA equivalents in English. We call this mapping a "Kanyen'kéha IPA to English IPA" mapping. If you have already created your mapping between the orthography and the IPA, you can generate this "Kanyen'kéha IPA to English IPA" using the `g2p` command line. 

Then, we convert the ReadAlong in question from its original orthographic form all the way to English IPA (well, actually to 'Arpabet' which is an ASCII-compliant phonetic transcription standard that the alignment model understands).

Then, after we "do the alignment" (ie figure out which parts of the audio correspond to which part of the text), ReadAlongs puts it all back together again and ta-da! There is your aligned audio and text!

#### Generate your mapping between your language's IPA and English IPA

After [installing](#installation) `g2p` and once you have made your mapping, update `g2p` by running `g2p update`. When you add or modify any mapping, `g2p` doesn't actually see it yet. `g2p update` is what scans all the mappings and makes them available to `g2p`. Then, you can run `g2p generate-mapping <input-code> --ipa`. So in our example for Kanyen'kéha (moh) we would run 

```bash
g2p generate-mapping moh --ipa
```

That will automatically generate a moh-ipa to eng-ipa mapping in `g2p/mappings/langs/generated` - do not edit this file or its configuration unless you really know what you're doing, because it will get overwritten. After generation, you can run `g2p update` again and your mapping will be [usable](#usage) within `g2p`!

#### Visualizing the process

This is actually where the introductory picture to this blog post comes from! In the graphic below, you can see the word 'bonjour' in French converted to its IPA transcription. Then, its IPA transcription gets converted into its corresponding *English* IPA transcription based on the generated mapping (notice how uvular /ʁ/ gets transformed to alveolo-palatal /ʒ/). Then finally, the English IPA form is converted to Arpabet. So in all, we have an input of 'bonjour' that gets output as 'B AO N ZH UW ZH' and the aligner runs on that form.

{% picture bonjour-g2p.png %}

You can recreate this type of animation using the G2P studio by selecting the French (`fra`) to English Arpabet (`eng-arpabet`) mapping, choosing 'animate' and then typing your text in the input area as seen below:

{% picture g2p-animate.png %}

#### What can you do with your aligned audio/text?

ReadAlongs exports to a variety of formats, including epub (for e-readers), [Praat](https://www.fon.hum.uva.nl/praat/) TextGrids, [ELAN](https://archive.mpi.nl/tla/elan) files, various subtitle formats, and an embeddable web component for your website. This project is still *very* unstable though, and it is **not** yet recommended to use it in production.

Below is an example of the embeddable web component in Danish.

{% include readalong.html text="/assets/ras/output.xml" alignment="/assets/ras/output.smil" audio="/assets/ras/output.wav" %}

### Convertextract

Convertextract is a tool that lets you use `g2p` mappings to convert text inside a variety of different documents. Have a look at the [convertextract repo readme](https://github.com/roedoejet/convertextract) or at Fineen Davis' [blog post]({{ "convertextract-app" | absolute_url }}) about the Convertextract GUI.

### Advanced: use in Python and the command line

#### Installation

We recommend installing `g2p` using [pip](https://en.wikipedia.org/wiki/Pip_(package_manager)):

```python
pip install g2p
```

If you are going to be creating your own mapping or editing `g2p` in any way, you must first fork `g2p` by going to [https://github.com/roedoejet/g2p](https://github.com/roedoejet/g2p) and forking the project to your own GitHub space.

Once you've forked `g2p`, clone your own fork:

```bash
git clone https://github.com/YourGitHubUsername/g2p.git
```

and then do an *editable* pip installation:

```bash
cd g2p && pip install -e .
```

#### Usage

Using `g2p` within Python can be done, either programatically using the `make_g2p` function:

```python
>>> from g2p import make_g2p
>>> transducer = make_g2p('dan', 'eng-arpabet')
>>> transducer('hej').output_string
'HH EH Y'
```

#### Command Line Interface

You can also use `g2p` from the command line. The basic command for conversions is:

```bash
g2p convert <input_text> <in_lang> <out_lang>
```

So in practice:

```bash
$ g2p convert hej dan eng-arpabet
HH EH YY
```
